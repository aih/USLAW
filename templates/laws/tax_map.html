{% extends "base.html" %}
{% block title %}Map of References For {% for s in sections %}ยง {{ s.section }}{% if not forloop.last %}, {% endif %}{% endfor %}{% endblock %}
{% block extrahead %}
<script type="text/javascript">
function getInternetExplorerVersion()
    // Returns the version of Internet Explorer or a -1
    // (indicating the use of another browser).
    {
      var rv = -1; // Return value assumes failure.
      if (navigator.appName == 'Microsoft Internet Explorer')
      {
	var ua = navigator.userAgent;
	var re  = new RegExp("MSIE ([0-9]{1,}[\.0-9]{0,})");
	if (re.exec(ua) != null)
	  rv = parseFloat( RegExp.$1 );
      }
      return rv;
    }
    function checkVersion()
    {
      var ver = getInternetExplorerVersion();
      if ( ver > -1 ) {
	  msg = "Sorry, tax-map is not yet available for Internet Explorer";
	  alert( msg );
      }
    }
    

  checkVersion();
</script>


<script type="text/javascript" src="{{ STATIC_URL }}js/jquery.form.js"></script>
<!--[if IE]><script type="text/javascript" src="{{ STATIC_URL }}js/excanvas.js"></script><![endif]-->
<script type="text/javascript" src="{{ STATIC_URL }}js/graph.js"></script>

{% autoescape off %}
  <style type="text/css">
    #graph { display: block; position: relative; overflow: hidden; }
    .node-label { font: 11px sans-serif; }
  </style>

<script type="text/javascript">

    $(document).ready(function() {
	var options = { 
          cache:false,
          method:"GET", 
          target:"#graph",
          beforeSubmit: function(arr, $form, options) {
             window.scrollTo(0,0);
             $("#graph").hide();
             $("#spinner").show();
          },
	  success: function() { 
             $("#graph").show();
             $("#spinner").hide();
          } 
        }

      $('#id_tax_map_form').ajaxForm(options);

    });

   function togle_options(){
     if ($('#hide').text()=='Hide options'){
       $('#map-settings').hide('slow');
       $('#hide').text('Show options');
     } else {
       $('#map-settings').show('slow');
       $('#hide').text('Hide options');
     }
   }

   function update_map(section_id){
      var a = $("#id_sections").val(section_id); 
      if (a == false){
        return false;
      }
      $("#id_display_selected_sections").val(false);
      $("#id_tax_map_form").submit();
    }

  </script>


{% endautoescape %}

{% endblock %}
{% block content %}
  <div id="id_title" style="text-align:center; margin-top:-30px; width:1000px; font-size:16px;">
  </div>
  <div id="id_title_error" style="text-align:center; color:red; width:1000px; font-size:16px;">
  </div>

  <div id="hide" class="left pointer" onclick="togle_options();">Hide options</div>
  <div id="map-settings" class="left" style="width:1000px;">
    <div class="left width100"><div class="left big18">Choose one or more sections and click 'Update' to see a map of reference links: </div></div>

    <form id="id_tax_map_form" action="/laws/tax-map-ajax/" method="GET">
      <div class="left width100" style="padding:10px;">
	{{ form.sections }}
      </div>
      <div class="left" style="width:45%; padding:10px;">  
	{{ form.link_type }}</div>
      <div class="left" style="width:45%; padding:10px;"> 
	<span id="id_bubbles_checkbox">Show text preview when hovering over links?</span> {{ form.display_bubble }}<br />
	<span id="id_selected_sections_checkbox">Show links only between selected sections?</span> {{ form.display_selected_sections }}<br />
	<span id="id_avatars_checkbox">Show who commented?</span> {{ form.display_avatars }}
      </div>

      <div class="left width100" style="padding:10px;">
	<input id ="id_update" type="submit" value = "Update" class="right_btn find_btn" />
      </div>
      <br />
    </form>
  </div>

  <div id="spinner" style="display:none; width:100px; padding-top:100px; padding-bottom:500px; padding-left:250px; margin-left:auto; margin-right:auto;"><img src="{{ STATIC_URL }}img/spinner2.gif" /></div>
  <div id="graph" style="width:1030px; height:600px; margin-left:-30px; border:1px solid #E1E5E8;" class="left">

  </div>

    <div class="left" style="margin-top:10px;">
    
      <div class="addthis_toolbox addthis_default_style ">
	<a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
	<a class="addthis_button_tweet"></a>
	<a class="addthis_button_linkedin" title="LinkedIn"><img src="{{ STATIC_URL }}img/linkedin-share.png" width="60" border="0" alt="LinkedIn" /></a>
	<a class="addthis_counter addthis_pill_style"></a>
      </div>
      <script type="text/javascript">var addthis_config = {"data_track_clickback":true};</script>
      <script type="text/javascript" src="http://s7.addthis.com/js/250/addthis_widget.js#pubid=aih26"></script>
    
    </div>

{% endblock %}
